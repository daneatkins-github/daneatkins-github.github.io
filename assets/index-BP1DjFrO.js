(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const i of t)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function a(t){const i={};return t.integrity&&(i.integrity=t.integrity),t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?i.credentials="include":t.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(t){if(t.ep)return;t.ep=!0;const i=a(t);fetch(t.href,i)}})();console.log("Script; Module... running");const J=await $arcgis.import("@arcgis/core/Map.js");await $arcgis.import("@arcgis/core/views/MapView.js");const c=await $arcgis.import("@arcgis/core/layers/FeatureLayer.js"),B=await $arcgis.import("@arcgis/core/Graphic.js");await $arcgis.import("@arcgis/core/rest/support/Query.js");var p=null;function Z(e,s,a,o){function t(X){return X*Math.PI/180}const i=t(e),l=t(s),u=t(a),d=t(o),{sin:y,cos:r,sqrt:h,atan2:M}=Math,L=6371,Y=u-i,$=d-l,U=y(Y/2)*y(Y/2)+r(i)*r(u)*y($/2)*y($/2),V=2*M(h(U),h(1-U));return L*V}async function ee(e,s){var a={where:s,outFields:["*"],returnGeometry:!0},o=await e.queryFeatures(a);return o.features}function te(e,s){console.log("inDrawPoints: ",g),x.removeAll(),f.removeAll();const a={type:"point",x:e,y:s,spatialReference:{wkid:4326}};let o={type:"simple-marker",color:"green",outline:{color:"red",width:"4.5px"},style:"circle"},t=new B({geometry:a,symbol:o});x.add(t)}function K(e){const s={type:"simple-fill",color:[1,128,0,.2],outline:{color:[0,128,0,.8],width:2}},a={type:"simple-line",color:"green",width:"3px"};var o=s;for(let d=0;d<e.length;d++){e[d].geometry.type==="polyline"?o=a:o=s;var t=new B({geometry:e[d].geometry,symbol:o});f.add(t)}let i={type:"simple-marker",color:[0,0,0,0]},l=new B({geometry:p,symbol:i});if(f.add(l),e[0].layer==I){var u=e[0].geometry.extent;u.clone(),g.goTo({target:e[0],zoom:15})}else g.goTo(f.graphics)}async function v(e,s,a,o){var t={geometry:e,spatialRelationship:"intersects",distance:a,units:o,outFields:["*"],returnGeometry:!0},i=await s.queryFeatures(t);return i.features}async function w(e,s,a){console.log("Nearest Query: iterative..."),a||(a=528);var o=a,t=!1;do{var i={geometry:e,spatialRelationship:"intersects",distance:o,units:"feet",outFields:["*"],returnGeometry:!0},l=await s.queryFeatures(i);l.features.length>0?t=!0:o=o+o,o>15e3&&(t=!0)}while(!t);if(l.features.length>0){for(var u=20,d=!1,y=0;y<l.features.length;y++){var r=l.features[y],h=null,M=null;r.geometry.centroid&&(h=r.geometry.centroid.x,M=r.geometry.centroid.y),r.geometry.paths&&(h=r.geometry.paths[0][0],M=r.geometry.paths[0][1]),h&&M&&(r.distance=Z(p.y,p.x,M,h)*.62137119,r.distance<u&&(u=r.distance,d=y))}d||(d=0);var L=l.features.slice(d,d+1)}else var L=!1;return L}async function T(e){console.log("Point: ",e);var s=document.getElementById("progress_bar");s.value=0;var a=13;Q("off");var o=parseFloat(e.x).toFixed(4),t=parseFloat(e.y).toFixed(4);document.getElementById("near_me_header").innerHTML="<h4>Near me... &nbsp;&nbsp;&nbsp; "+t+"°N, "+Math.abs(o)+"°W",te(e.x,e.y);for(var i=document.getElementsByClassName("popup_col_val"),l=0;l<i.length;l++)i[l].innerHTML='<calcite-loader label="Fetching..." scale="s"></calcite-loader>',i[l].classList.remove("active");var u=await v(e,F,1,"feet");if(u.length>0){v(e,k,1,"feet").then(r=>{r.length>0?document.getElementById("td_quad").innerHTML=r[0].attributes.Quadrant:document.getElementById("td_quad").innerHTML="...",s.value+=1/a*100}),v(e,A,1,"feet").then(r=>{r.length>0?document.getElementById("td_councildist").innerHTML=r[0].attributes.PubName:document.getElementById("td_councildist").innerHTML="...",s.value+=1/a*100}),v(e,P,1,"feet").then(r=>{r.length>0?document.getElementById("td_firedist").innerHTML=r[0].attributes.NAME:document.getElementById("td_firedist").innerHTML="...",s.value+=1/a*100}),v(e,D,1,"feet").then(r=>{r.length>0?document.getElementById("td_policedist").innerHTML=r[0].attributes.DIST_NME:document.getElementById("td_policedist").innerHTML="...",s.value+=1/a*100}),v(e,O,1,"feet").then(r=>{r.length>0?document.getElementById("td_solidwaste").innerHTML=r[0].attributes.DAYWEEK:document.getElementById("td_solidwaste").innerHTML="...",s.value+=1/a*100}),v(e,E,1,"feet").then(r=>{r.length>0?(document.getElementById("td_schoolelem").innerHTML=r[0].attributes.ElementarySchool,document.getElementById("td_schoolmid").innerHTML=r[0].attributes.MiddleSchool,document.getElementById("td_schoolhigh").innerHTML=r[0].attributes.HighSchool):(document.getElementById("td_schoolelem").innerHTML="...",document.getElementById("td_schoolmid").innerHTML="...",document.getElementById("td_schoolhigh").innerHTML="..."),s.value+=3/a*100}),w(e,I,10).then(r=>{document.getElementById("td_addr").innerHTML=r[0].attributes.SITEADDRESS,s.value+=1/a*100,K(r),document.getElementById("td_addr").classList.add("active")}),w(e,R).then(r=>{r?document.getElementById("td_parks").innerHTML=r[0].attributes.NAME:document.getElementById("td_parks").innerHTML="<span style='font-style:italic;'>... no results within 3 miles</span>",s.value+=1/a*100}),w(e,G,2500).then(r=>{r?document.getElementById("td_ssmid").innerHTML=r[0].attributes.Type:document.getElementById("td_ssmid").innerHTML="<span style='font-style:italic;'>... no results within 3 miles</span>",s.value+=1/a*100}),w(e,q,1500).then(r=>{r?document.getElementById("td_nhrplandmark").innerHTML=r[0].attributes.site_name:document.getElementById("td_nhrplandmark").innerHTML="<span style='font-style:italic;'>... no results within 3 miles</span>",s.value+=1/a*100}),w(e,j,1500).then(r=>{r?document.getElementById("td_nhrpdistrict").innerHTML=r[0].attributes.Type:document.getElementById("td_nhrpdistrict").innerHTML="<span style='font-style:italic;'>... no results within 3 miles</span>",s.value+=1/a*100}),w(e,W,1500).then(r=>{r?document.getElementById("td_cipproject").innerHTML=r[0].attributes.ProjName:document.getElementById("td_cipproject").innerHTML="<span style='font-style:italic;'>... no results within 3 miles</span>",s.value+=1/a*100});const d=window.location.href.split("?")[0],y="?xy="+o+","+t;window.history.replaceState&&window.history.replaceState({},null,d+y)}return!0}async function Q(e){var s=await document.getElementsByClassName("tr_showmore");if(e==="off"){for(var a=0;a<s.length;a++)s[a].classList.add("tr_hide");document.getElementById("tr_showmore_btn").classList.remove("tr_hide")}else{for(var a=0;a<s.length;a++)s[a].classList.remove("tr_hide");document.getElementById("tr_showmore_btn").classList.add("tr_hide")}return!0}async function re(e){console.log("popupClick_event:",e);for(var s=document.getElementsByClassName("popup_col_val"),a=0;a<s.length;a++)s[a].classList.remove("active");f.removeAll(),H.opacity=0,C.opacity=0,m.opacity=0,m.definitionExpression=null,e.target.classList.add("active");var o=e.target.innerHTML,t=null,i=null;if(e.target.id==="td_addr")var t=I,i="SITEADDRESS";if(e.target.id==="td_solidwaste")var t=O,i="DAYWEEK";if(e.target.id==="td_quad")var t=k,i="Quadrant";if(e.target.id==="td_policedist"){var t=D,i="DIST_NME";H.opacity=1}if(e.target.id==="td_firedist"){var t=P,i="NAME";C.opacity=1}if(e.target.id==="td_councildist")var t=A,i="PubName";if(e.target.id==="td_schoolelem"){var t=E,i="ElementarySchool";m.definitionExpression="SUB_CLASS = 'Elementary' AND CITY = 'Cedar Rapids'",m.opacity=1}if(e.target.id==="td_schoolmid"){var t=E,i="MiddleSchool";m.definitionExpression="SUB_CLASS = 'Middle' AND CITY = 'Cedar Rapids'",m.opacity=1}if(e.target.id==="td_schoolhigh"){var t=E,i="HighSchool";m.definitionExpression="SUB_CLASS = 'High School' AND CITY = 'Cedar Rapids'",m.opacity=1}if(e.target.id==="td_parks")var t=R,i="NAME";if(e.target.id==="td_ssmid")var t=G,i="Type";if(e.target.id==="td_nhrplandmark")var t=q,i="site_name";if(e.target.id==="td_nhrpdistrict")var t=j,i="Type";if(e.target.id==="td_cipproject")var t=W,i="ProjName";if(i!=null){var l=i+" = '"+o+"'",u=await ee(t,l);K(u)}}const g=await document.querySelector("arcgis-map");g.map=new J({basemap:"topo"});const n=g.map;g.zoom=12;g.center=[-91.667,41.975];g.constraints={geometry:{type:"extent",xmin:-92.65,ymin:41.1,xmax:-90.5,ymax:42.9},minScale:5e5,rotationEnabled:!1};const se={type:"simple",symbol:{type:"simple-fill",color:[0,0,0,0],outline:{width:2,color:[204,85,0]}}},F=new c({url:"https://crgis.cedar-rapids.org/arcgisserver/rest/services/CMO/Near_Me_Map_Layers/FeatureServer/20",outFields:["*"],opacity:1,popupEnabled:!1,renderer:se});n.add(F);const I=new c({url:"https://crgis.cedar-rapids.org/arcgisserver/rest/services/CMO/Near_Me_Map_Layers/FeatureServer/17",outFields:["*"],opacity:0,popupEnabled:!1});n.add(I);const z=await $arcgis.import("@arcgis/core/layers/GraphicsLayer.js");let f=new z({graphics:null});n.add(f);let x=new z({graphics:null});n.add(x);const O=new c({url:"https://crgis.cedar-rapids.org/arcgis/rest/services/Maps/NeighborhoodApp/MapServer/0",outFields:["*"],opacity:0,popupEnabled:!1});n.add(O);const k=new c({url:"https://crgis.cedar-rapids.org/arcgisserver/rest/services/CMO/Near_Me_Map_Layers/FeatureServer/19",outFields:["*"],opacity:0,popupEnabled:!1});n.add(k);const A=new c({url:"https://crgis.cedar-rapids.org/arcgisserver/rest/services/CMO/Near_Me_Map_Layers/FeatureServer/5",outFields:["*"],opacity:0,popupEnabled:!1});n.add(A);const P=new c({url:"https://crgis.cedar-rapids.org/arcgisserver/rest/services/CMO/Near_Me_Map_Layers/FeatureServer/7",outFields:["*"],opacity:0,popupEnabled:!1});n.add(P);const C=new c({url:"https://crgis.cedar-rapids.org/arcgisserver/rest/services/CMO/Near_Me_Map_Layers/FeatureServer/6",outFields:["*"],opacity:0,popupEnabled:!1});n.add(C);const D=new c({url:"https://crgis.cedar-rapids.org/arcgisserver/rest/services/CMO/Near_Me_Map_Layers/FeatureServer/9",outFields:["*"],opacity:0,popupEnabled:!1});n.add(D);const H=new c({url:"https://crgis.cedar-rapids.org/arcgisserver/rest/services/CMO/Near_Me_Map_Layers/FeatureServer/8",outFields:["*"],opacity:0,popupEnabled:!1});n.add(H);const E=new c({url:"https://crgis.cedar-rapids.org/arcgisserver/rest/services/CMO/Near_Me_Map_Layers/FeatureServer/3",outFields:["*"],opacity:0,popupEnabled:!1});n.add(E);const m=new c({url:"https://crgis.cedar-rapids.org/arcgisserver/rest/services/CMO/Near_Me_Map_Layers/FeatureServer/2",outFields:["*"],opacity:0,popupEnabled:!1});n.add(m);const R=new c({url:"https://crgis.cedar-rapids.org/arcgisserver/rest/services/CMO/Near_Me_Map_Layers/FeatureServer/13",outFields:["*"],opacity:0,popupEnabled:!1});n.add(R);const G=new c({url:"https://crgis.cedar-rapids.org/arcgisserver/rest/services/CMO/Near_Me_Map_Layers/FeatureServer/10",outFields:["*"],opacity:0,popupEnabled:!1});n.add(G);const j=new c({url:"https://crgis.cedar-rapids.org/arcgisserver/rest/services/CMO/Near_Me_Map_Layers/FeatureServer/15",outFields:["*"],opacity:0,popupEnabled:!1});n.add(j);const q=new c({url:"https://crgis.cedar-rapids.org/arcgisserver/rest/services/CMO/Near_Me_Map_Layers/FeatureServer/14",outFields:["*"],opacity:0,popupEnabled:!1});n.add(q);const W=new c({url:"https://crgis.cedar-rapids.org/arcgis/rest/services/Maps/Public_Works/MapServer/35",outFields:["*"],opacity:0,popupEnabled:!1});n.add(W);const ae=window.location.search,ie=new URLSearchParams(ae),S={};ie.forEach((e,s)=>{S[s]=e});if(S.xy){console.log("... resolving URL parameter 'XY'");const e=S.xy.split(",")[0],s=S.xy.split(",")[1];var p={type:"point",x:e,y:s,spatialReference:{wkid:4326}};console.log("call_popup: ",p),T(p)}else{var p={type:"point",x:-91.6697,y:41.9774,spatialReference:{wkid:4326}};console.log("call_popup: ",p),T(p)}let oe={type:"simple-marker",color:"black",size:4,style:"circle"};const le=new c({url:"https://crgis.cedar-rapids.org/arcgisserver/rest/services/CMO/Near_Me_Map_Layers/FeatureServer/18",outFields:["*"],opacity:1,popupEnabled:!0,renderer:{type:"simple",symbol:oe}});n.add(le);const _=document.querySelector("arcgis-search");_.popupDisabled=!0;_.resultGraphicDisabled=!0;_.goToOverride=function(){console.log("search GoTO NOTHING")};_.includeDefaultSourcesDisabled=!0;_.minSuggestCharacters=2;var ne=[{name:"ArcGIS World Geocoder",placeholder:"101 1st Ave SE",singleLineFieldName:"SingleLine",url:"https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer",locationType:"rooftop",filter:{geometry:{type:"extent",xmin:-92.65,ymin:41.1,xmax:-90.5,ymax:42.9}}}];_.sources=ne;_.addEventListener("arcgisSearchComplete",async function(e){if(e.detail.results.length>0){var s=e.detail.results,a=s[0].results;console.log(a);var o=e.detail.results[0].results[0].feature;if(o.geometry.latitude&&o.geometry.longitude){var t={type:"point",x:o.geometry.longitude,y:o.geometry.latitude,spatialReference:{wkid:4326}},i=await v(t,F,1,"feet");i.length>0&&(p=t,T(p))}}});var ce={include:[F]};g.addEventListener("arcgisViewClick",e=>{console.log("map click",e),g.hitTest(e.detail,ce).then(s=>{if(console.log("Processing mapClick...",s),console.log(g.map),s.results.length){const a=s.results[0];p={type:"point",x:a.mapPoint.longitude,y:a.mapPoint.latitude,spatialReference:{wkid:4326}},T(p)}})});var de=document.getElementById("showmore_btn");de.addEventListener("click",function(e){Q()});console.log("Popup 'listeners'");var N=document.getElementsByClassName("popup_col_val");for(var b=0;b<N.length;b++)N[b].classList.remove("active"),N[b].addEventListener("mousedown",function(e){f.removeAll(),re(e)});

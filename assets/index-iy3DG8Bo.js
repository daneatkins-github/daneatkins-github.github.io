(function(){const k=document.createElement("link").relList;if(k&&k.supports&&k.supports("modulepreload"))return;for(const f of document.querySelectorAll('link[rel="modulepreload"]'))S(f);new MutationObserver(f=>{for(const m of f)if(m.type==="childList")for(const x of m.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&S(x)}).observe(document,{childList:!0,subtree:!0});function O(f){const m={};return f.integrity&&(m.integrity=f.integrity),f.referrerPolicy&&(m.referrerPolicy=f.referrerPolicy),f.crossOrigin==="use-credentials"?m.credentials="include":f.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function S(f){if(f.ep)return;f.ep=!0;const m=O(f);fetch(f.href,m)}})();var I=document.querySelector("arcgis-map"),F="InfraView",V=[],n=[],H=[902,903,907,908,906,904],q="collapse",P=null;const N=await $arcgis.import("@arcgis/core/core/reactiveUtils.js");await $arcgis.import("@arcgis/core/core/Collection.js");function $(T){let k=T+"=",S=decodeURIComponent(document.cookie).split(";");for(let f=0;f<S.length;f++){let m=S[f];for(;m.charAt(0)==" ";)m=m.substring(1);if(m.indexOf(k)==0)return m.substring(k.length,m.length)}return""}document.addEventListener("DOMContentLoaded",async function(){let T=document.documentElement;function k(){function r(){T.style.setProperty("--sidebar_width","30px"),document.getElementById("content_leftSidebar_open").classList.add("display_none"),document.getElementById("content_leftSidebar_closed").classList.remove("display_none")}function u(){T.style.setProperty("--sidebar_width","360px"),document.getElementById("content_leftSidebar_open").classList.remove("display_none"),document.getElementById("content_leftSidebar_closed").classList.add("display_none")}function c(d){function e(){T.style.setProperty("--footer_height","350px"),document.getElementById("footer").classList.remove("footer_enlarged"),document.getElementById("content").classList.remove("content_footer_enlarged"),document.getElementById("tablink_Shrink").classList.add("display_none"),document.getElementById("tablink_Collapse").classList.remove("display_none"),document.getElementById("tablink_Enlarge").classList.remove("display_none");var o,l;for(l=document.getElementsByClassName("tabcontent"),o=0;o<l.length;o++)l[o].classList.add("tab_height_normal"),l[o].classList.remove("tab_height_enlarge")}function a(){document.getElementById("footer").classList.remove("footer_enlarged"),document.getElementById("content").classList.remove("content_footer_enlarged"),T.style.setProperty("--footer_height","40px"),document.getElementById("tablink_Shrink").classList.add("display_none"),document.getElementById("tablink_Collapse").classList.add("display_none"),document.getElementById("tablink_Enlarge").classList.add("display_none")}function y(){document.getElementById("footer").classList.add("footer_enlarged"),document.getElementById("content").classList.add("content_footer_enlarged"),document.getElementById("tablink_Enlarge").classList.add("display_none"),document.getElementById("tablink_Shrink").classList.remove("display_none")}if(q=d,d==="enlarge"){y();return}if(d==="expand"){e();return}a()}function g(d,e){var a,y,o;for(y=document.getElementsByClassName("tabcontent"),a=0;a<y.length;a++)y[a].classList.add("display_none");for(o=document.getElementsByClassName("tablinks"),a=0;a<o.length;a++)o[a].className=o[a].className.replace(" active","");e?(document.getElementById(e).classList.remove("display_none"),d.currentTarget.className+=" active",P=e):P=null}function s(){document.getElementById("sidebar_collapse_btn").addEventListener("click",function(){r()}),document.getElementById("sidebar_expand_btn").addEventListener("click",function(){u()});for(var d=document.getElementsByClassName("tablinks"),e=0;e<d.length;e++)d[e].addEventListener("click",function(){console.log("Footer Tab Click Event...");var i=event.target.id,t=i.replace("link","");t===P?(console.log("Footer Click Event: Same tab, do nothing."),c("collapse"),g(event,null)):(console.log("... changing active tab to ",t),i!="tablink_Collapse"&&i!="tablink_Enlarge"&&i!="tablink_Shrink"?(g(event,t),q==="collapse"&&c("expand")):(i==="tablink_Collapse"&&(c("collapse"),g(event,null)),i==="tablink_Shrink"&&c("expand"),i==="tablink_Enlarge"&&c("enlarge")))});document.getElementById("header_menu_btn").addEventListener("click",function(){document.getElementById("header_menu_content").classList.toggle("display_none")}),document.addEventListener("click",function(i){var t=document.getElementById("header_menu_content"),E=document.getElementById("header_menu_btn");i.target!=t&&i.target!=E&&t.classList.add("display_none")});for(let i of header_menu_content.children)i.addEventListener("click",function(t){x(t.target.id)});document.getElementById("signOnBtn_Staff").addEventListener("click",async function i(t){const E=await $arcgis.import("@arcgis/core/layers/MapImageLayer.js");let _=new E({url:"https://crgis.cedar-rapids.org/arcgisserver/rest/services/InfraView/Infrastructure_Viewer_Secured_Services/MapServer"});await I.map.add(_),I.whenLayerView(_).then(p=>{console.log("layerview fired; user authenticated"),document.getElementById("signOnBtn_Public").classList.remove("signOn_active"),document.getElementById("header_signOn").classList.add("header_signOn_success"),document.getElementById("signOnBtn_Staff").classList.add("signOn_active"),document.getElementById("signOnBtn_Staff").classList.remove("header_signOn_hover"),document.getElementById("signOnBtn_Staff").removeEventListener("click",i)}).catch(p=>{console.log("err adding secure svc / sign in failed")})});function a(){window.innerWidth<680?(document.getElementById("header_title").classList.add("header_title_narrow"),document.getElementById("header_title_text").classList.add("display_none")):(document.getElementById("header_title").classList.remove("header_title_narrow"),document.getElementById("header_title_text").classList.remove("display_none"))}a(),window.addEventListener("resize",()=>{a()});var y=document.getElementById("splash");function o(){y.classList.add("display_none");var i=document.getElementById("splash_doNotShowAgain");console.log(i),i.checked&&(document.cookie="tutorial=false")}var l=$("tutorial");console.log("splashCookie",l),l!=""&&l=="false"&&(document.getElementById("splash_doNotShowAgain").checked=!0,o());var L=document.getElementById("splash_content"),B=document.getElementById("splash_close_btn");B.addEventListener("click",function(){o()});var h=0,b=document.getElementById("splash_next_btn");b.addEventListener("click",function(){h+=1,console.log("Splash Page: ",h),h==1&&(L.innerHTML='<img src="loader_map_icon.png" style="width:65px;height:65px;float:right">The Layer List (on the left) controls the data drawn in the map.  With over 100 map layers available, you may need to wait for the map to update fully (watch the loading icon, top-right of the map). <br><br>Change the Basemap or review visible map symbols with the Basemaps and Legend tab below; use the Tables tab to get more detailed data from each map layer!'),h==2&&(L.innerHTML='<div style="text-align:left";>In addition to the Basemaps and Tables, several tool widgets are embedded in the map:<div style="height:8px; width:100%"></div><li>Search: based on Address Locator services,</li><li>Measure & Coordinates: for spatial reference,</li><li>Draw & Print: for quick markup and sharing,</li></div><div style="height:8px; width:100%"></div>There are also several bookmarked map views to access our most popular datasets.'),h==3&&(L.innerHTML='<br>This map tool was developed by the GIS Team of the Division of Information Technology at the City of Cedar Rapids.  We value your feedback!  If you have any trouble with the map or map data, or if you have a suggestion on ways we could improve this tool, please reach out to<br><a href="mailto:IT-GIS@cedar-rapids.org">IT-GIS@cedar-rapids.org</a>.',b.innerHTML="Finish"),h==4&&o()}),document.getElementById("expand_about_icon").addEventListener("click",function(){console.log("about press"),h=0;var t='If you are new to this application, the next few slides will help familiarize you with the layout of this application and some of the basic map tools.<br><br>If you were looking for our older, legacy Infrastructure Viewer, <a href="https://crgis.cedar-rapids.org/IV/index.html">please click here</a>.If you have comments or requests for this application, please <a href="https://survey123.arcgis.com/share/9d13577027034d9cb9cf3eb7d0cd7c6b">complete the provided Survey, here</a>.<br><hr>';L.innerHTML=t,y.classList.remove("display_none")})}s()}k(),console.log("Defined layout functions and events");async function O(){async function r(){const s=await $arcgis.import("@arcgis/core/config.js");s.portalUrl="https://crgis.cedar-rapids.org/arcgisportal/",console.log("... configured Portal Server.")}async function u(){var s="1c82087191d7448ba521adf7c620826e";I.itemId=s,I.center=[-91.65074851467115,41.976330102403125],I.zoom=2}async function c(){const s=document.querySelector("arcgis-layer-list");s.visibilityAppearance="checkbox",s.dragEnabled=!0;const[d,e,a,y]=await $arcgis.import(["@arcgis/core/support/actions/ActionButton.js","@arcgis/core/core/Collection.js","@arcgis/core/widgets/Slider.js","@arcgis/core/core/reactiveUtils.js"]);s.listItemCreatedFunction=o=>{var l={};l=o.item,H.includes(l.layer.id)&&(l.layer.popupEnabled=!1),y.watch(()=>l.visible,i=>{console.log("Reactive to item.visible in LayerList");async function t(){V=await S(),f(V)}t()});var L=new d({title:"Layer Information",icon:"information",id:"information"}),B=new d({title:"Filter Layer",icon:"filter",id:"filter"}),h=new d({title:"View in Table",icon:"table",id:"table"});if(l.layer.popupEnabled)var b=new d({title:"Disable Info Popup",icon:"content-none",id:"popup"});else var b=new d({title:"Enable Info Popup",icon:"popup",id:"popup"});if(l.layer.url,l.layer.url&&l.layer.url.includes("Infrastructure_Viewer")&&!l.children.length>0&&l.parent){const i=new a({min:0,max:1,precision:2,values:[1],visibleElements:{labels:!0,rangeLabels:!0}});l.panel={content:i,icon:"sliders-horizontal",title:"Layer Transparency"},y.watch(()=>i.values.map(t=>t),t=>{l.layer.opacity=t[0]}),l.actionsSections=new e([new e([L,B,h,b])])}else l.actionsSections=new e([new e([L])])},s.addEventListener("arcgisTriggerAction",o=>{const l=o.detail.action.id,L=o.detail.item.layer.url,B=o.detail.item.layer;if(l==="information"&&window.open(L),l==="filter"&&m(B),l==="popup"&&(o.detail.item.layer.popupEnabled?(o.detail.action.title="Enable Info Popup",o.detail.action.icon="popup",o.detail.item.layer.popupEnabled=!1):(o.detail.action.title="Disable Info Popup",o.detail.action.icon="content-none",o.detail.item.layer.popupEnabled=!0)),l==="table"){async function h(){P!=="tab_Tables"&&await document.getElementById("tablink_Tables").click();var b=await document.querySelector("arcgis-feature-table"),i=o.detail.item.layer;async function t(){b.layer=i}setTimeout(t,50)}h()}}),console.log("... configured LayerList Actions.")}async function g(){var s=document.querySelector("arcgis-feature-table");s.menuConfig={items:[{label:"Export table",icon:"download",clickFunction:()=>{var d=JSON.parse(JSON.stringify(s.highlightIds));s.layer.queryObjectIds().then(function(e){s.highlightIds=e,s.exportSelectionToCSV().then(function(){d&&d.length?s.highlightIds=d:s.highlightIds=[]})})}},{label:"Select all",icon:"selection",clickFunction:()=>{s.layer.queryObjectIds().then(function(d){s.highlightIds=d})}}]},console.log("... configured Feature Table menu.")}await r(),await u(),c(),g()}O(),console.log("MapView initialized"),I.addEventListener("arcgisViewReadyChange",r=>{console.log("MapView Exists.");async function u(){V=await S(),console.log("Visible Layers:",V);var c=I.map.layers.find(g=>g.title==="Sketch Layer");c.listMode="hide",f(V)}console.log(" ... .updating:",I.updating),N.once(()=>I.updating).then(()=>{console.log(" ... .updating:",I.updating),console.log("Initializing Layers..."),u();const c=window.location.search,g=new URLSearchParams(c);g.get("bookmark")&&(x(g.get("bookmark")),console.log("... reading Bookmark View from URL parameter")),document.getElementById("tablink_Tables").disabled=!1,document.getElementById("loader_init").classList.add("display_none")}),N.watch(()=>I.layerViews.map(c=>c.updating),c=>{c.every(s=>!s)?document.getElementById("loader_map").classList.add("display_none"):document.getElementById("loader_map").classList.remove("display_none")})});async function S(){var r=[],u=I.map.allLayers;return u.forEach(async function(c,g){if(c.url&&c.url.includes(F)&&(c.IsReallyVisible=c.visible,c.sublayers)){async function s(d){d.forEach(function(e){e.parent.IsReallyVisible&&e.visible?e.IsReallyVisible=!0:e.IsReallyVisible=!1,e.sublayers&&s(e.sublayers),e.IsReallyVisible&&!e.sublayers&&r.push(e)})}await s(c.sublayers)}}),r}function f(r){var u=document.querySelector("arcgis-feature-table"),c=u.layer;u.layers=r,u.layer=c}async function m(r){async function u(){console.log("Iterating over "+n.length+" active filters."),n.forEach(function(i){if(i!=null){var t="",E=i.field_selector_element.value.split(",")[1],_=i.field_selector_element.value.split(",")[2],p=i.value_selector.value;_=="string"&&(p="'"+p+"'");var v=i.comparators.value.split(",")[1];if(v==="is not"&&(v=" <> "),v==="is"&&(v=" = "),t=`${E} ${v} ${p}`,v==="is any of"){var C;_=="string"?(v=" IN ('",C="','"):(v=" IN (",C=",");var w=Array.from(i.value_selector.selectedOptions).map(A=>A.value);w.length<1&&(t=null),w.length==1,w.length>1&&(p=w.join(C),t=`${E} ${v}${p}`,_=="string"?t+="')":t+=")")}console.log(t),i.definitionExpression=t,document.getElementById("active_filters_btn").classList.remove("display_none"),console.log(i)}})}async function c(){console.log("removing filters"),n.forEach(function(i){i!=null&&(i.definitionExpression=null)}),document.getElementById("active_filters_btn").classList.add("display_none")}var g=document.getElementById("filter-modal"),s=document.getElementById("filter-container"),d=!1;if(r.fields&&r.fields.length>0&&r.fields.forEach(function(i){["OBJECTID","objectid","shape","SHAPE","Shape"].includes(i.name)||(d=!0)}),d){var e=-1;if(n.includes(r))e=n.indexOf(r),console.log("active filter, index "+e);else{n.push(r),e=n.indexOf(r),n.index=e,console.log("adding new filter, index "+e),n[e].title=r.title,n[e].field_selector=document.createElement("select"),n[e].field_selector.id="filter_fieldlist_"+e.toString(),n[e].value_selector=document.createElement("select"),n[e].value_selector.id="filter_valuelist_"+e.toString(),n[e].value_selector.style.width="220px",n[e].field_options="",console.log("field check: ",r),r.fields.forEach(function(t){["OBJECTID","objectid","shape","SHAPE","Shape"].includes(t.name)||(n[e].field_options+='<option value="'+e+","+t.name+","+t.type+'">'+t.alias+"</option>")}),n[e].field_selector.insertAdjacentHTML("beforeend",n[e].field_options);var a=["is","is not","is any of"],y="";n[e].comparators=document.createElement("select"),n[e].comparators.id="filter_comparator_"+e.toString(),a.forEach(function(t){y+='<option value="'+e+","+t+'">'+t+"</option>"}),n[e].comparators.insertAdjacentHTML("beforeend",y);var o="<div id='filter_layer_item"+e+"' class='filter_layerItem'>"+n[e].title;o+="<div class='filter_remove_btn' id='remove_filter_"+e+"'>X</div>",o+="<br></div>",s.insertAdjacentHTML("beforeend",o);var l=document.getElementById("filter_layer_item"+e);l.appendChild(n[e].field_selector),l.appendChild(n[e].comparators),l.insertAdjacentHTML("beforeend","<br>"),l.appendChild(n[e].value_selector),n[e].removeButton=document.getElementById("remove_filter_"+e),n[e].removeButton.value=e,n[e].removeButton.addEventListener("click",async function(t){var E=t.target.value,_="filter_layer_item"+E.toString();document.getElementById(_).remove(),n[e].definitionExpression=null,n[e]=null,console.log("Removed "+_);var p=!1;n.forEach(function(v){v!=null&&(p=!0)}),p||(g.classList.add("display_none"),document.getElementById("active_filters_btn").classList.add("display_none"))}),n[e].comparators_element=document.getElementById(n[e].comparators.id),n[e].comparators_element.addEventListener("change",async function(t){const E=t.target.value.split(",")[0],_=t.target.value.split(",")[1];var p=document.getElementById(n[E].value_selector.id);_==="is any of"?p.multiple=!0:p.multiple=!1}),n[e].field_selector_element=document.getElementById(n[e].field_selector.id),n[e].field_selector_element.addEventListener("change",async function(t){const E=t.target.value.split(",")[0],_=n[E],p=t.target.value.split(",")[1];var v=document.getElementById(n[E].value_selector.id);v.disabled=!0;const C=await $arcgis.import("@arcgis/core/rest/support/Query.js"),w=new C;w.where="1=1",w.returnDistinctValues=!0,w.outFields=[p],w.returnGeometry=!1;var A=[];console.log("Getting unique values from layer/field.."),_.queryFeatures(w).then(R=>{A=R.features.map(M=>M.attributes[p]),v.options.length=0;var j=[];A.forEach(function(M){j+='<option value="'+M+'">'+M+"</option>"}),v.insertAdjacentHTML("beforeend",j),v.disabled=!1})}),n[e].field_selector_element.dispatchEvent(new Event("change"))}var b=document.getElementById("filter_close_btn");if(b.getAttribute("listener")!=="true"){b.addEventListener("click",function(t){g.classList.add("display_none")}),b.setAttribute("listener","true");var L=document.getElementById("apply_filters_btn"),B=document.getElementById("disable_filters_btn");L.addEventListener("click",function(t){u()}),B.addEventListener("click",function(t){c()});var h=document.getElementById("active_filters_btn");h.addEventListener("click",function(t){var E=document.getElementById("filter-modal");document.getElementById("filter-container"),E.classList.remove("display_none")})}}var b=document.getElementById("filter_close_btn");if(b.getAttribute("listener")!=="true"){b.addEventListener("click",function(_){g.classList.add("display_none")}),b.setAttribute("listener","true");var L=document.getElementById("apply_filters_btn"),B=document.getElementById("disable_filters_btn");L.addEventListener("click",function(_){u()}),B.addEventListener("click",function(_){c()});var h=document.getElementById("active_filters_btn");h.addEventListener("click",function(_){var p=document.getElementById("filter-modal");document.getElementById("filter-container"),p.classList.remove("display_none")})}g.classList.remove("display_none")}function x(r){console.log("Loading a bookmarked view");var u=[600,859,905,908,852,851];r==="projects"&&(u=[600,859,905,908,852,851,999]),r==="mowing"&&(u=[897,898,861,863,864,865,905,908,999]),r==="streets"&&(u=[897,899,772,776,905,908,999]),r==="snowops"&&(u=[897,900,727,24,721,724,905,908,999]),r==="water"&&(u=[101,120,87,88,92,108,119,905,908,999]),r==="sanitary"&&(u=[101,5,6,7,9,10,11,12,905,908,999]),r==="storm"&&(u=[101,71,70,0,2,3,905,908,999]);var c=document.querySelector("arcgis-layer-list"),g=c.operationalItems;async function s(a){a.children&&a.children.items.forEach(function(y){s(y)}),u.includes(a.layer.id)?(a.layer.visible=!0,a.open=!0):(a.layer.visible=!1,a.open=!1,a.parent||(a.layer.visible=!0,a.open=!0))}g.forEach(function(a,y){a.layer.url&&a.layer.url.includes("InfraView")&&s(a)});const d=window.location.href.split("?")[0],e="?bookmark="+r;window.history.replaceState&&window.history.replaceState({},null,d+e)}console.log("End DOMContentLoaded Functions")});
